

<div class="container mt-4" ng-controller="khachHangCtrl">

  <button class="btn btn-primary mb-3" ng-click="openAddModal()">
    Thêm khách hàng
  </button>



  <h2>Danh sách khách hàng</h2>

  <div class="row mb-3">
    <div class="col-md-4">
      <input type="text"
             class="form-control"
             placeholder="Tìm kiếm"
             ng-model="keyword">
    </div>
  </div>


  <table class="table table-bordered table-hover">
    <thead class="table-dark">
    <tr>
      <th>STT</th>
      <th>Mã</th>
      <th>Tên</th>
      <th>Email</th>
      <th>Giới tính</th>
      <th>SĐT</th>
      <th>Địa chỉ</th>
      <th>Trạng thái</th>
      <th>Hành động</th>
    </tr>
    </thead>
    <tbody>
    <tr ng-repeat="kh in dsKhachHang | orderBy:'-ma' | filter: keyword">
      <td>{{$index + 1}}</td>
      <td>{{kh.ma}}</td>
      <td>{{kh.ten}}</td>
      <td>{{kh.email}}</td>
      <td>{{kh.gioiTinh}}</td>
      <td>{{kh.sdt}}</td>
      <td>{{kh.diaChi}}</td>
      <td>{{kh.trangThai == 1 ? 'Hoạt động' : 'Ngưng'}}</td>
      <td>
        <button class="btn btn-info btn-sm" ng-click="showDetail(kh.id)">Chi tiết</button>


      </td>
    </tr>
    </tbody>
  </table>


  <div class="modal" ng-show="showDetailModal" style="display:block; background: rgba(0,0,0,0.5);">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Chi tiết khách hàng</h5>
          <button type="button" class="btn-close" ng-click="closeDetailModal()"></button>
        </div>
        <form name="khForm" novalidate>

          <div class="modal-body">
            <div class="row">
          <div class="mb-3">
            <label>Tên:</label>
            <input type="text"
                   class="form-control"
                   name="ten"
                   ng-model="detailKhachHang.ten"
                   required
                   ng-minlength="3">

            <small class="text-danger"
                   ng-show="khForm.ten.$touched && khForm.ten.$invalid">
              Tên không được để trống (ít nhất 3 ký tự)
            </small>
          </div>


          <div class="mb-3">
            <label>Email:</label>
            <input type="email"
                   class="form-control"
                   name="email"
                   ng-model="detailKhachHang.email"
                   required>

            <small class="text-danger"
                   ng-show="khForm.email.$touched && khForm.email.$invalid">
              Email không hợp lệ
            </small>
          </div>


          <div class="mb-3">
            <label>Giới tính:</label>
            <select class="form-control"
                    ng-model="detailKhachHang.gioiTinh"
                    required>
              <option value="">-- Chọn giới tính --</option>
              <option value="Nam">Nam</option>
              <option value="Nữ">Nữ</option>
            </select>
          </div>


          <div class="mb-3">
            <label>SĐT:</label>
            <input type="text"
                   class="form-control"
                   name="sdt"
                   ng-model="detailKhachHang.sdt"
                   ng-pattern="/^(0[0-9]{9,10})$/"
                   required>

            <small class="text-danger"
                   ng-show="khForm.sdt.$touched && khForm.sdt.$invalid">
              SĐT phải bắt đầu bằng 0 và có 10–11 số
            </small>
          </div>


          <div class="mb-3">
            <label>Địa chỉ:</label>
            <input type="text"
                   class="form-control"
                   ng-model="detailKhachHang.diaChi"
                   required>

            <small class="text-danger"
                   ng-show="khForm.$submitted && !detailKhachHang.diaChi">
              Địa chỉ không được để trống
            </small>
          </div>


          <div class="mb-3">
            <label>Trạng thái:</label>
            <select class="form-control"
                    ng-model="detailKhachHang.trangThai"
                    required>
              <option value="1">Hoạt động</option>
              <option value="0">Ngưng</option>
            </select>
          </div>
            </div>
          </div>
        </form>

        <div class="modal-footer">
          <button type="button"
                  class="btn btn-success"
                  ng-click="updateKhachHang()"
                  ng-disabled="khForm.$invalid">
            Cập nhật
          </button>

          <button type="button"
                  class="btn btn-secondary"
                  ng-click="closeDetailModal()">
            Đóng
          </button>
        </div>
      </div>
    </div>
  </div>


  <div class="modal" ng-show="showAddModal" style="display:block; background: rgba(0,0,0,0.5);">
    <div class="modal-dialog">
      <form class="modal-content" name="addForm" novalidate>

        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">Thêm khách hàng</h5>
          <button class="btn-close btn-close-white"
                  ng-click="closeAddModal()"></button>
        </div>

        <div class="modal-body">
          <div class="row">

<!--            <div class="mb-3">-->
<!--              <label class="form-label">Mã khách hàng</label>-->
<!--              <input type="text"-->
<!--                     class="form-control"-->
<!--                     ng-model="newKhachHang.ma"-->
<!--                     readonly>-->
<!--            </div>-->


            <div class="col-md-6 mb-3">
              <label class="form-label">Tên khách hàng</label>
              <input type="text" class="form-control"
                     ng-model="newKhachHang.ten"
                     name="ten" required>
              <small class="text-danger"
                     ng-show="addForm.ten.$touched && addForm.ten.$invalid">
                Tên không được để trống
              </small>
            </div>

            <div class="col-md-6 mb-3">
              <label class="form-label">Email</label>
              <input type="email" class="form-control"
                     ng-model="newKhachHang.email"
                     name="email" required>
              <small class="text-danger"
                     ng-show="addForm.email.$touched && addForm.email.$invalid">
                Email không hợp lệ
              </small>
              <small class="text-danger" ng-if="errorEmail">
                {{ errorEmail }}
              </small>
            </div>

            <div class="col-md-6 mb-3">
              <label class="form-label">Giới tính</label>
              <select class="form-select"
                      ng-model="newKhachHang.gioiTinh"
                      name="gioiTinh" required>
                <option value="">-- Chọn --</option>
                <option value="Nam">Nam</option>
                <option value="Nữ">Nữ</option>
              </select>
              <small class="text-danger"
                     ng-show="addForm.gioiTinh.$touched && addForm.gioiTinh.$invalid">
                Vui lòng chọn giới tính
              </small>
            </div>

            <div class="col-md-6 mb-3">
              <label class="form-label">Số điện thoại</label>
              <input type="text" class="form-control"
                     ng-model="newKhachHang.sdt"
                     name="sdt"
                     ng-pattern="/^(0[0-9]{9,10})$/"
                     required>
              <small class="text-danger"
                     ng-show="addForm.sdt.$touched && addForm.sdt.$invalid">
                SĐT bắt đầu bằng 0, 10–11 số
              </small>
              <small class="text-danger" ng-if="errorSdt">
                {{ errorSdt }}
              </small>
            </div>

            <div class="col-md-6 mb-3">
              <label class="form-label">Trạng thái</label>
              <select class="form-select"
                      ng-model="newKhachHang.trangThai">
                <option value="1">Hoạt động</option>
                <option value="0">Ngưng</option>
              </select>
            </div>

            <div class="col-12 mb-3">
              <label class="form-label">Địa chỉ</label>
              <input type="text" class="form-control"
                     ng-model="newKhachHang.diaChi"
                     name="diaChi" required>
              <small class="text-danger"
                     ng-show="addForm.diaChi.$touched && addForm.diaChi.$invalid">
                Địa chỉ không được để trống
              </small>
            </div>

          </div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-success" ng-click="addKhachHang()">Thêm</button>
          <button class="btn btn-secondary" ng-click="closeAddModal()">Đóng</button>
        </div>

      </form>
    </div>
  </div>

</div>
